import React, { useState } from "react";

// DemoCourseSite.jsx
// Single-file React component demo for a vocational course site (Logistics Customer Service)
// Tailwind classes used for styling (assumes Tailwind is configured in the host app).
// Default export is a React component that renders a small multi-page site with
// Homepage, Chapters, Case Library, Quiz, and Teacher Panel.

export default function DemoCourseSite() {
  const [route, setRoute] = useState("home");
  const [userRole, setUserRole] = useState("student"); // 'student' or 'teacher'

  // Sample course data
  const initialChapters = [
    {
      id: 1,
      title: "第1章 物流客户服务概论",
      summary: "介绍物流客户服务的岗位职责、服务流程与职业素养。",
      content:
        "物流客户服务包括订单跟踪、客户沟通、投诉处理和售后回访等核心流程。重点培养学生的沟通技巧和问题解决能力。",
    },
    {
      id: 2,
      title: "第2章 客户沟通与话术",
      summary: "常见沟通场景与标准话术、倾听与情绪管理。",
      content:
        "学习如何在投诉处理、延迟交付、货损报备等场景中使用规范话术来化解矛盾并维护客户满意度。",
    },
    {
      id: 3,
      title: "第3章 投诉处理流程实战",
      summary: "从受理到结案的投诉处理流程与示范话术。",
      content:
        "掌握受理、调查、沟通、补救与归档五步法，并通过情景演练巩固技能。",
    },
  ];

  const initialCases = [
    {
      id: 1,
      title: "案例 A：配送延迟 48 小时",
      description:
        "客户对配送延迟表示强烈不满，要求赔偿。请给出安抚话术与后续处理流程。",
      solution:
        "1) 道歉并承认问题；2) 说明原因并给出补救方案；3) 提供合理补偿并跟踪结果。示范话术：\n\"非常抱歉给您带来不便，我们马上为您查询原因，并在24小时内给出补救方案。\"",
    },
    {
      id: 2,
      title: "案例 B：货物破损申诉",
      description:
        "客户收到货物破损，要求退货并索赔。请列出处理步骤与注意点。",
      solution:
        "1) 要求客户提供照片与订单号；2) 记录并上报仓配部门；3) 安排退换货+赔偿流程；4) 跟进并确认客户满意。",
    },
  ];

  const initialQuiz = [
    {
      id: 1,
      q: "客户投诉时，第一步通常应该是？",
      choices: ["马上推卸责任", "先倾听并道歉", "直接给补偿", "忽略投诉"],
      a: 1,
    },
    {
      id: 2,
      q: "关于物流客户服务，下列哪项不是常见工作内容？",
      choices: ["订单跟踪", "客户沟通", "仓库理货（全部）", "售后回访"],
      a: 2,
    },
  ];

  const [chapters, setChapters] = useState(initialChapters);
  const [cases, setCases] = useState(initialCases);
  const [quiz, setQuiz] = useState(initialQuiz);

  // teacher inputs for quick content generation (simulated AI generation)
  function teacherGenerateChapter() {
    const newId = chapters.length + 1;
    const generated = {
      id: newId,
      title: `第${newId}章 AI 生成：案例分析与角色扮演`,
      summary: "由大模型快速生成的教学单元，含任务、话术与练习题。",
      content:
        "示例：让学生两人一组扮演客服与客户，进行情景演练；教师布置评分细则并录制示范。",
    };
    setChapters((p) => [...p, generated]);
  }

  function teacherGenerateCase() {
    const newId = cases.length + 1;
    const generated = {
      id: newId,
      title: `案例 ${String.fromCharCode(64 + newId)}：AI 生成情境 ${newId}`,
      description: "AI 生成的情境描述（示例）。",
      solution: "AI 生成的参考解决方案与话术。",
    };
    setCases((p) => [...p, generated]);
  }

  // Quiz interaction state
  const [answers, setAnswers] = useState({});
  const [submitted, setSubmitted] = useState(false);

  function toggleAnswer(qid, idx) {
    setAnswers((p) => ({ ...p, [qid]: idx }));
  }

  function submitQuiz() {
    setSubmitted(true);
  }

  // UI components
  const Nav = () => (
    <div className="flex items-center justify-between p-4 bg-white shadow">
      <div className="flex items-center gap-3">
        <div className="w-10 h-10 bg-blue-600 text-white font-semibold rounded flex items-center justify-center">LS</div>
        <div>
          <div className="font-semibold">物流客户服务 - 课程示范</div>
          <div className="text-xs text-gray-500">中职财经商贸 · 物流客服服务</div>
        </div>
      </div>
      <div className="flex items-center gap-3">
        <div className="text-sm text-gray-600">角色</div>
        <select
          value={userRole}
          onChange={(e) => setUserRole(e.target.value)}
          className="border rounded px-2 py-1"
        >
          <option value="student">学生</option>
          <option value="teacher">教师</option>
        </select>
        <div className="flex gap-2">
          <button onClick={() => setRoute('home')} className="px-3 py-2 rounded hover:bg-gray-100">首页</button>
          <button onClick={() => setRoute('chapters')} className="px-3 py-2 rounded hover:bg-gray-100">章节</button>
          <button onClick={() => setRoute('cases')} className="px-3 py-2 rounded hover:bg-gray-100">案例库</button>
          <button onClick={() => setRoute('quiz')} className="px-3 py-2 rounded hover:bg-gray-100">测验</button>
          <button onClick={() => setRoute('teacher')} className="px-3 py-2 rounded hover:bg-gray-100">教师中心</button>
        </div>
      </div>
    </div>
  );

  const Home = () => (
    <div className="p-6">
      <div className="grid lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2 bg-white rounded shadow p-6">
          <h2 className="text-xl font-semibold mb-2">课程简介</h2>
          <p className="text-gray-700 mb-4">
            《物流客户服务基础》——培养学生掌握客户沟通、投诉处理与售后服务的核心技能，适配真实岗位场景。
          </p>
          <div className="flex gap-3">
            <div className="px-3 py-2 border rounded">学习目标：岗位胜任、沟通能力、问题解决</div>
            <div className="px-3 py-2 border rounded">课时：36</div>
            <div className="px-3 py-2 border rounded">形式：案例教学 + 角色扮演</div>
          </div>

          <div className="mt-6">
            <h3 className="font-medium mb-2">本周任务</h3>
            <ol className="list-decimal ml-5 text-gray-700">
              <li>预习第2章：客户沟通与话术</li>
              <li>完成在线测验（至少80%）</li>
              <li>小组角色扮演录像并提交</li>
            </ol>
          </div>
        </div>

        <div className="bg-white rounded shadow p-6">
          <h3 className="text-lg font-semibold mb-3">进度与小结</h3>
          <div className="text-sm text-gray-600">已完成：第1章</div>
          <div className="mt-3">
            <div className="text-sm">学习小贴士</div>
            <ul className="list-disc ml-5 text-gray-700 text-sm">
              <li>练习标准话术时录音并回听</li>
              <li>遇投诉先记录关键事实再沟通</li>
            </ul>
          </div>
        </div>
      </div>

      <div className="mt-6 grid grid-cols-2 gap-4">
        <div className="bg-white rounded shadow p-4">
          <h4 className="font-medium">快速入口</h4>
          <div className="mt-2 flex flex-col gap-2">
            <button onClick={() => setRoute('chapters')} className="p-2 border rounded text-left">查看章节</button>
            <button onClick={() => setRoute('cases')} className="p-2 border rounded text-left">前往案例库</button>
            <button onClick={() => setRoute('quiz')} className="p-2 border rounded text-left">开始测验</button>
          </div>
        </div>

        <div className="bg-white rounded shadow p-4">
          <h4 className="font-medium">教师提示</h4>
          <div className="text-sm text-gray-700 mt-2">教师可以一键生成章节或案例供课堂讨论（示例中使用本地生成函数模拟AI生成）。</div>
        </div>
      </div>
    </div>
  );

  const Chapters = () => (
    <div className="p-6">
      <h2 className="text-xl font-semibold mb-4">章节列表</h2>
      <div className="grid md:grid-cols-2 gap-4">
        {chapters.map((c) => (
          <div key={c.id} className="bg-white rounded shadow p-4">
            <div className="flex justify-between items-start">
              <div>
                <h3 className="font-medium">{c.title}</h3>
                <div className="text-sm text-gray-600">{c.summary}</div>
              </div>
              <button
                className="text-sm border px-3 py-1 rounded"
                onClick={() => alert(`${c.title}\n\n${c.content}`)}
              >
                查看内容
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  const Cases = () => (
    <div className="p-6">
      <h2 className="text-xl font-semibold mb-4">案例库</h2>
      <div className="grid md:grid-cols-2 gap-4">
        {cases.map((cs) => (
          <div key={cs.id} className="bg-white rounded shadow p-4">
            <h3 className="font-medium">{cs.title}</h3>
            <div className="text-sm text-gray-700 mt-2">{cs.description}</div>
            <div className="mt-3 text-xs text-gray-500">参考解决方案（点击查看）</div>
            <button className="mt-2 border rounded px-3 py-1" onClick={() => alert(cs.solution)}>
              查看方案
            </button>
          </div>
        ))}
      </div>
    </div>
  );

  const Quiz = () => (
    <div className="p-6">
      <h2 className="text-xl font-semibold mb-4">在线测验</h2>
      <div className="bg-white rounded shadow p-4">
        {quiz.map((q) => (
          <div key={q.id} className="mb-4">
            <div className="font-medium">{q.id}. {q.q}</div>
            <div className="mt-2 grid gap-2">
              {q.choices.map((ch, idx) => (
                <label key={idx} className={`p-2 border rounded flex items-center gap-2 ${answers[q.id]===idx? 'bg-gray-100':''}`}>
                  <input type="radio" name={`q${q.id}`} checked={answers[q.id]===idx} onChange={() => toggleAnswer(q.id, idx)} />
                  <span className="text-sm">{ch}</span>
                </label>
              ))}
            </div>
            {submitted && (
              <div className="mt-2 text-sm">
                正确答案：{q.choices[q.a]} &nbsp; {answers[q.id]===q.a ? <span className="text-green-600">回答正确</span> : <span className="text-red-600">回答错误</span>}
              </div>
            )}
          </div>
        ))}

        <div className="flex gap-3">
          <button onClick={submitQuiz} className="px-4 py-2 border rounded">提交</button>
          <button onClick={() => { setAnswers({}); setSubmitted(false); }} className="px-4 py-2 border rounded">重置</button>
        </div>
      </div>
    </div>
  );

  const Teacher = () => (
    <div className="p-6">
      <h2 className="text-xl font-semibold mb-4">教师中心</h2>
      <div className="bg-white rounded shadow p-4">
        <div className="mb-4">
          <div className="font-medium">快速生成教学单元（示例）</div>
          <div className="text-sm text-gray-600 mt-1">点击下面按钮，模拟使用大模型为本课程生成新章节或案例并加入数据库。</div>
          <div className="mt-3 flex gap-3">
            <button onClick={teacherGenerateChapter} className="px-3 py-2 border rounded bg-blue-600 text-white">生成章节</button>
            <button onClick={teacherGenerateCase} className="px-3 py-2 border rounded bg-blue-600 text-white">生成案例</button>
          </div>
        </div>

        <div>
          <div className="font-medium mb-2">现有资源统计</div>
          <div className="text-sm">章节：{chapters.length} &nbsp;|&nbsp; 案例：{cases.length} &nbsp;|&nbsp; 测验题：{quiz.length}</div>
        </div>
      </div>

      <div className="mt-6">
        <h3 className="font-medium mb-2">导出 / 部署建议</h3>
        <ul className="list-disc ml-5 text-sm text-gray-700">
          <li>将本组件嵌入到 Vite / Create React App 项目中，配置 Tailwind 后即可预览。</li>
          <li>部署建议：GitHub Pages、Netlify 或 Vercel。</li>
        </ul>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-50">
      <Nav />
      <div className="max-w-6xl mx-auto mt-6">
        {route === 'home' && <Home />}
        {route === 'chapters' && <Chapters />}
        {route === 'cases' && <Cases />}
        {route === 'quiz' && <Quiz />}
        {route === 'teacher' && userRole === 'teacher' && <Teacher />}
        {route === 'teacher' && userRole !== 'teacher' && (
          <div className="p-6">教师中心仅限教师角色访问。请在右上角选择“教师”。</div>
        )}
      </div>

      <footer className="mt-8 p-4 text-center text-sm text-gray-500">示范课程网站 · 物流客户服务（AI 生成示例）</footer>
    </div>
  );
}
